<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <script>
    // Component to spawn spheres around the camera in real 3D world space
    AFRAME.registerComponent('bubble-spawner', {
      schema: {
        count:   {default: 20},   // how many spheres to spawn
        minDist: {default: 1.0},  // min distance from camera
        maxDist: {default: 3.0},  // max distance from camera
        minY:    {default: -0.5}, // vertical range relative to camera
        maxY:    {default: 1.5}
      },

      init: function () {
        this.cameraEl = document.querySelector('[camera]');
        // Wait a tiny bit so AR session has time to start & camera pose is valid
        setTimeout(() => this.spawnBubbles(), 1000);
      },

      spawnBubbles: function () {
        if (!this.cameraEl) {
          console.warn('No [camera] entity found');
          return;
        }

        const sceneEl = this.el;              // the <a-scene>
        const camObj  = this.cameraEl.object3D;
        const camPos  = new THREE.Vector3();
        camObj.getWorldPosition(camPos);

        const data = this.data;

        for (let i = 0; i < data.count; i++) {
          // random direction on XZ plane
          const angle = Math.random() * Math.PI * 2;
          const dist  = data.minDist + Math.random() * (data.maxDist - data.minDist);
          const yOff  = data.minY + Math.random() * (data.maxY - data.minY);

          const x = camPos.x + Math.cos(angle) * dist;
          const z = camPos.z + Math.sin(angle) * dist;
          const y = camPos.y + yOff;

          const bubble = document.createElement('a-sphere');
          bubble.setAttribute('radius', 0.12);
          bubble.setAttribute('position', `${x} ${y} ${z}`);
          bubble.setAttribute('color', '#AEE5FF');
          bubble.setAttribute('opacity', 0.6);
          bubble.setAttribute('transparent', true);
          bubble.setAttribute('metalness', 0.1);
          bubble.setAttribute('roughness', 0.1);

          sceneEl.appendChild(bubble);
        }
      }
    });
  </script>
</head>

<body style="margin: 0; overflow: hidden;">
  <a-scene
    renderer="antialias:true; colorManagement:true; physicallyCorrectLights:true"
    webxr="mode: ar; optionalFeatures: hit-test, local-floor"
    embedded
    bubble-spawner>

    <!-- AR camera -->
    <a-entity camera position="0 1.6 0"></a-entity>

    <!-- Soft ambient light so bubbles arenâ€™t totally flat -->
    <a-entity light="type: ambient; intensity: 1.0"></a-entity>
    <a-entity light="type: directional; intensity: 0.6" position="1 3 2"></a-entity>
  </a-scene>
</body>
</html>
