<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>AR Sphere Spawner - Debug</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #ui {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      margin: 5px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }
    #debug {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 999;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      padding: 10px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 12px;
      max-width: 300px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

  <!-- Debug Console -->
  <div id="debug">Initializing...</div>

  <!-- Spawn Button -->
  <div id="ui">
    <button id="spawn-btn">ðŸŒŸ SPAWN SPHERE</button>
    <div style="margin-top: 10px; font-size: 14px;">
      Spheres: <span id="count">0</span>
    </div>
  </div>

  <!-- AR Scene -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true;">

    <!-- AR Camera -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Lighting -->
    <a-light type="ambient" intensity="1"></a-light>
    <a-light type="directional" position="1 1 1" intensity="0.8"></a-light>

    <!-- Container for spheres -->
    <a-entity id="sphere-container"></a-entity>

  </a-scene>

  <script>
    let sphereCount = 0;
    const container = document.querySelector('#sphere-container');
    const countDisplay = document.querySelector('#count');
    const debugDiv = document.querySelector('#debug');

    // Debug logging
    function log(msg) {
      console.log(msg);
      debugDiv.innerHTML += msg + '<br>';
      debugDiv.scrollTop = debugDiv.scrollHeight;
    }

    // Colors
    const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];

    function getRandomColor() {
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // Spawn sphere directly in front of camera
    function spawnSphere() {
      const camera = document.querySelector('[camera]');
      
      if (!camera) {
        log('âŒ Camera not found!');
        return;
      }

      // Get camera's position and rotation
      const cameraPos = camera.object3D.position;
      const cameraRot = camera.object3D.rotation;
      
      log(`ðŸ“· Camera pos: ${cameraPos.x.toFixed(2)}, ${cameraPos.y.toFixed(2)}, ${cameraPos.z.toFixed(2)}`);

      // Calculate position in front of camera
      const distance = 2; // meters in front
      const direction = new THREE.Vector3(0, 0, -1); // Forward direction
      direction.applyEuler(camera.object3D.rotation);
      
      const spawnPos = new THREE.Vector3(
        cameraPos.x + direction.x * distance,
        cameraPos.y + direction.y * distance,
        cameraPos.z + direction.z * distance
      );

      log(`ðŸŽ¯ Spawning at: ${spawnPos.x.toFixed(2)}, ${spawnPos.y.toFixed(2)}, ${spawnPos.z.toFixed(2)}`);

      // Create sphere
      const sphere = document.createElement('a-sphere');
      sphere.setAttribute('position', `${spawnPos.x} ${spawnPos.y} ${spawnPos.z}`);
      sphere.setAttribute('radius', '0.3'); // Bigger sphere
      sphere.setAttribute('color', getRandomColor());
      sphere.setAttribute('material', 'side: double'); // Visible from both sides
      
      // Add glow effect
      sphere.setAttribute('material', 'shader: flat; emissive: ' + getRandomColor() + '; emissiveIntensity: 0.5');

      container.appendChild(sphere);
      sphereCount++;
      updateCount();
      
      log(`âœ… Sphere #${sphereCount} created`);
    }

    function updateCount() {
      countDisplay.textContent = sphereCount;
    }

    // Button handler
    document.querySelector('#spawn-btn').addEventListener('click', function(e) {
      e.preventDefault();
      log('ðŸ–±ï¸ Button clicked');
      spawnSphere();
    });

    // Scene loaded handler
    const scene = document.querySelector('a-scene');
    scene.addEventListener('loaded', function() {
      log('âœ… AR Scene loaded');
      log('ðŸ“± Camera should be active');
      
      // Auto-spawn test sphere after 2 seconds
      setTimeout(() => {
        log('ðŸš€ Auto-spawning test sphere...');
        spawnSphere();
      }, 2000);
    });

    // Camera ready handler
    scene.addEventListener('camera-init', function() {
      log('ðŸ“· Camera initialized');
    });

    // AR.js ready handler
    window.addEventListener('arjs-video-loaded', function() {
      log('ðŸ“¹ AR video loaded');
    });

    log('ðŸ”„ Script loaded, waiting for AR...');

  </script>

</body>
</html>
