<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>AR Sphere Spawner</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #ui {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      margin: 5px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    button:active {
      transform: scale(0.95);
    }
    #info {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-family: Arial, sans-serif;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- Info Display -->
  <div id="info">
    Spheres: <span id="count">0</span> | Tap screen or button to spawn
  </div>

  <!-- Spawn Button -->
  <div id="ui">
    <button id="spawn-btn">ðŸŒŸ SPAWN SPHERE</button>
  </div>

  <!-- AR Scene -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; precision: medium;"
    gesture-detector>

    <!-- AR Camera -->
    <a-entity camera look-controls="enabled: false"></a-entity>

    <!-- Container for spheres in world space -->
    <a-entity id="sphere-container"></a-entity>

    <!-- Ambient light -->
    <a-light type="ambient" color="#BBB"></a-light>
    <a-light type="directional" position="0 1 0" intensity="0.5"></a-light>

  </a-scene>

  <script>
    // Sphere tracking
    let sphereCount = 0;
    const container = document.querySelector('#sphere-container');
    const countDisplay = document.querySelector('#count');
    const spawnBtn = document.querySelector('#spawn-btn');

    // Color palette
    const colors = [
      '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A',
      '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2',
      '#FF85A2', '#7FDBFF', '#39CCCC', '#FFDC00'
    ];

    function getRandomColor() {
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // Get position in front of camera in world space
    function getSpawnPosition() {
      const camera = document.querySelector('[camera]');
      const cameraEl = camera.object3D;
      
      // Get camera's world position and direction
      const direction = new THREE.Vector3();
      cameraEl.getWorldDirection(direction);
      
      const position = new THREE.Vector3();
      cameraEl.getWorldPosition(position);
      
      // Random offset from center
      const spreadX = (Math.random() - 0.5) * 2; // -1 to 1
      const spreadY = (Math.random() - 0.5) * 2; // -1 to 1
      const distance = 2 + Math.random() * 3; // 2-5 units away
      
      // Calculate spawn position
      const spawnPos = new THREE.Vector3(
        position.x + direction.x * distance + spreadX,
        position.y + direction.y * distance + spreadY,
        position.z + direction.z * distance
      );
      
      return spawnPos;
    }

    // Create sphere in world space
    function spawnSphere() {
      const pos = getSpawnPosition();
      
      const sphere = document.createElement('a-sphere');
      sphere.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
      sphere.setAttribute('radius', '0.15');
      sphere.setAttribute('color', getRandomColor());
      sphere.setAttribute('metalness', '0.3');
      sphere.setAttribute('roughness', '0.7');
      
      // Add gentle floating animation
      sphere.setAttribute('animation', {
        property: 'position',
        to: `${pos.x} ${pos.y + 0.1} ${pos.z}`,
        dir: 'alternate',
        dur: 1500,
        loop: true,
        easing: 'easeInOutSine'
      });

      // Add rotation for visual interest
      sphere.setAttribute('animation__rotate', {
        property: 'rotation',
        to: '0 360 0',
        dur: 4000,
        loop: true,
        easing: 'linear'
      });

      // Click to remove (for touch devices)
      sphere.classList.add('clickable');
      sphere.addEventListener('click', function() {
        container.removeChild(sphere);
        sphereCount--;
        updateCount();
      });

      container.appendChild(sphere);
      sphereCount++;
      updateCount();
      
      console.log(`Spawned sphere at: ${pos.x.toFixed(2)}, ${pos.y.toFixed(2)}, ${pos.z.toFixed(2)}`);
    }

    // Update count display
    function updateCount() {
      countDisplay.textContent = sphereCount;
    }

    // Button click handler
    spawnBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      spawnSphere();
    });

    // Touch/click on screen to spawn
    const scene = document.querySelector('a-scene');
    scene.addEventListener('click', function(e) {
      // Only spawn if not clicking the button
      if (!e.target.closest('#ui')) {
        spawnSphere();
      }
    });

    // Register gesture detector component for better mobile interaction
    AFRAME.registerComponent('gesture-detector', {
      init: function() {
        this.handleTouch = this.handleTouch.bind(this);
        this.el.addEventListener('touchstart', this.handleTouch);
      },
      handleTouch: function(e) {
        // Touch detected - you could add custom logic here
        console.log('Touch detected');
      }
    });

    // Wait for scene to load, then spawn initial spheres
    scene.addEventListener('loaded', function() {
      console.log('AR Scene loaded! Point camera around and tap to spawn spheres.');
      
      // Spawn a few initial spheres after 1 second
      setTimeout(() => {
        spawnSphere();
      }, 1000);
    });

  </script>

</body>
</html>
